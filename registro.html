<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro de Usuario - Galaxia Magna Academy</title>
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

  <!--
    HEADER (Encabezado):
    Aquí va el título principal de la página. Sirve para que el usuario sepa dónde está y da identidad al sitio.
    Puedes poner el nombre de la plataforma, el logo o ambos.
  -->
  <header style="display: flex; align-items: center; justify-content: center; gap: 20px; padding: 20px;">
    <img src="images/GAM_transparent.png" alt="Galaxia Magna Academy Logo" style="width: 80px; height: 80px; object-fit: contain;">
    <div style="text-align: center;">
      <h1 style="color: #C0C0C0; margin-bottom: 5px; margin-top: 0;">Galaxia Magna Academy</h1>
      <h2 style="font-style: italic; font-weight: normal; font-size: 1.8em; margin-top: 0; color: #C0C0C0; margin-bottom: 0;">Sapientia per Stellam</h2>
    </div>
    <img src="images/GAM_transparent.png" alt="GMA Logo" style="width: 80px; height: 80px; object-fit: contain;">
  </header>

  <main>
    <section>
      <!--
        FORMULARIO DE REGISTRO:
        Página dedicada al registro de nuevos usuarios.
        Accesible solo para administradores.
      -->

      <!-- Navigation -->
      <nav style="margin-bottom: 20px;">
        <ul>
          <li><a href="index.html">← Volver al Inicio</a></li>
          <li><a href="#ayuda">Ayuda</a></li>
        </ul>
      </nav>

      <!-- Mensaje de registro -->
      <div id="registro-msg" style="display:none; font-weight:bold; margin-bottom:16px;"></div>
      
      <h2 style="color: #f18b32; text-align: center; margin-bottom: 30px;">Registro de Nuevo Usuario</h2>
      <p style="text-align: center; color: #C0C0C0; margin-bottom: 30px;">Panel de administración para registro de usuarios</p>

      <form id="registro-form" action="https://backend-kt0bm09wc-mowattabrs-projects.vercel.app" method="post">

        <!--
          Cada grupo de campos tiene su propio div para que el label quede arriba del input.
          Esto mejora la legibilidad y la experiencia de usuario.
        -->

        <fieldset>
          <legend>Registro de usuario</legend>
          
          <!-- Row y Col: Sistema de columnas para organizar el contenido en filas y columnas -->
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <!-- Form-label: Etiqueta que describe el campo de entrada -->
                <label for="username" class="form-label">Nombre de Usuario:</label>
                <!-- Form-control: Estilo para campos de entrada como text, email, password -->
                <input class="form-control" type="text" id="username" name="username" required>
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">Correo Electrónico:</label>
                <input class="form-control" type="email" id="email" name="email" required oninput="document.getElementById('email-error').style.display='none'">
                <span id="email-error" style="color: #ff6b6b; display: none;">El correo debe contener un @</span>
              </div>
              <div class="mb-3">
                <label for="telefono" class="form-label">Teléfono de Contacto:</label>
                <input class="form-control" type="tel" id="telefono" name="telefono" placeholder="Ej: 8888-8888">
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="mb-3">
                <label for="password" class="form-label">Contraseña:</label>
                <input class="form-control" type="password" id="password" name="password" required>
              </div>
              <div class="mb-3">
                <label for="confirm-password" class="form-label">Confirmar Contraseña:</label>
                <input class="form-control" type="password" id="confirm-password" name="confirm-password" required>
              </div>
              <div class="mb-3">
                <label for="fecha-nacimiento" class="form-label">Fecha de Nacimiento:</label>
                <input class="form-control" type="date" id="fecha-nacimiento" name="fecha-nacimiento" required>
              </div>
            </div>
          </div>

          <!-- Segunda fila: Rol, Fecha de Inscripción y Código -->
          <div class="row mt-3">
            <div class="col-md-4">
              <div class="mb-3">
                <label for="rol" class="form-label">Rol:</label>
                <select class="form-select" id="rol" name="rol" required onchange="manejarCambioRol()">
                  <option value="">Seleccione un rol</option>
                  <option value="estudiante">Estudiante</option>
                  <option value="profesor">Profesor</option>
                  <option value="administrador">Administrador</option>
                </select>
              </div>
              <!-- Campo de contraseña para roles especiales -->
              <div class="mb-3" id="password-rol-container" style="display: none;">
                <label for="password-rol" class="form-label">Contraseña del rol:</label>
                <input class="form-control" type="password" id="password-rol" name="password-rol" placeholder="Ingrese la contraseña del rol">
                <small class="form-text text-muted" id="password-rol-hint"></small>
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="fecha-inscripcion" class="form-label">Fecha de Inscripción:</label>
                <input class="form-control" type="date" id="fecha-inscripcion" name="fecha-inscripcion" required onchange="generarCodigoEstudiante()">
              </div>
            </div>
            <div class="col-md-4">
              <div class="mb-3">
                <label for="codigo-estudiante" class="form-label">Código de Usuario:</label>
                <input class="form-control" type="text" id="codigo-estudiante" name="codigo-estudiante" readonly placeholder="Se genera automáticamente" style="background-color: #f8f9fa;">
                <small class="form-text text-muted">Formato: AAAA_MM_ROL_0001</small>
              </div>
            </div>
          </div>

          <!--
            GÉNERO:
            Usa radio buttons para que el usuario solo pueda elegir una opción.
            Los labels están en línea para que se vean ordenados.
          -->
          <fieldset class="mt-4">
            <legend>Género</legend>
            <!-- Form-check: Contenedor para radio buttons y checkboxes -->
            <div class="form-check">
              <!-- Form-check-input: Radio buttons para seleccionar una opción -->
              <input class="form-check-input" type="radio" value="m" name="gender" id="g-m">
              <!-- Form-check-label: Etiqueta para radio buttons y checkboxes -->
              <label class="form-check-label" for="g-m">Masculino</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" value="f" name="gender" id="g-f">
              <label class="form-check-label" for="g-f">Femenino</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" value="o" name="gender" id="g-o">
              <label class="form-check-label" for="g-o">Otro</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" value="n" name="gender" id="g-n">
              <label class="form-check-label" for="g-n">Prefiero no decirlo</label>
            </div>
          </fieldset>

          <!--
            AVATAR DE GÉNERO:
            Muestra una imagen que cambia según la selección de género.
            Además, si pasas el mouse sobre el avatar, gira 360° (ver CSS para la animación).
          -->
          <fieldset>
            <legend style="visibility: hidden; height: 0; margin: 0; padding: 0;"></legend>
            <div style="display: flex;">
              <div id="avatar-genero"
                class="img_box">
                <img id="img-avatar-genero"
                  src="images/GMA.png"
                  alt="Avatar Género"
                  >
              </div>
            </div>
          </fieldset>

          <!--
            INTERESES:
            Usa checkboxes para que el usuario pueda elegir varios intereses.
            Al seleccionar un interés, la imagen correspondiente se ilumina (ver JS y CSS).
            Si seleccionas Star Wars, aparece un mensaje especial que se desvanece (ver JS y CSS).
          -->
          <fieldset class="mt-4">
            <legend>Seleccione sus intereses:</legend>
            <div>
              <!-- Opciones de intereses -->
              <div>
                <div class="form-check">
                  <!-- Checkbox: Permite seleccionar múltiples opciones -->
                  <input class="form-check-input" type="checkbox" name="intereses[]" id="interes1" value="programacion">
                  <label class="form-check-label" for="interes1">Programación</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="intereses[]" id="interes2" value="diseño">
                  <label class="form-check-label" for="interes2">Diseño Gráfico</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="intereses[]" id="interes3" value="marketing">
                  <label class="form-check-label" for="interes3">Marketing Digital</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="intereses[]" id="interes4" value="ciencia">
                  <label class="form-check-label" for="interes4">Ciencia de Datos</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="intereses[]" id="interes5" value="basketball">
                  <label class="form-check-label" for="interes5">Basketball</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="intereses[]" id="interes6" value="musica">
                  <label class="form-check-label" for="interes6">Música</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" name="intereses[]" id="interes7" value="starwars">
                  <label class="form-check-label" for="interes7">Star Wars</label>
                </div>
              </div>
              <!-- Cajas para imágenes de intereses -->
              <div class="interests-container" style="margin-top: 16px; margin-bottom: 40px;">
                <div id="imgbox1" class="img_box">
                  <img id="img-programacion"
                    src="https://images.icon-icons.com/1859/PNG/512/codinghtml_117947.png"
                    alt="Programación"
                    >
                </div>
                <div id="imgbox2"
                  class="img_box">
                  <img id="img-diseno"
                    src="https://images.icon-icons.com/537/PNG/512/paint-brush-2_icon-icons.com_52930.png"
                    alt="Diseño Gráfico"
                    >
                </div>
                <div id="imgbox3"
                  class="img_box">
                  <img id="img-marketing"
                    src="https://images.icon-icons.com/2069/PNG/512/coin_dollar_finance_icon_125510.png"
                    alt="Marketing Digital"
                    >
                </div>
                <div id="imgbox4"
                  class="img_box">
                  <img id="img-ciencia"
                    src="https://images.icon-icons.com/4277/PNG/512/finance_business_analysis_analytics_science_data_icon_266082.png"
                    alt="Ciencia de Datos"
                    >
                </div>
                <div id="imgbox5"
                  class="img_box">
                  <img id="img-basketball"
                    src="https://images.icon-icons.com/553/PNG/512/basketball_icon-icons.com_53566.png"
                    alt="Basketball"
                    >
                </div>
                <div id="imgbox6"
                  class="img_box">
                  <img id="img-musica"
                    src="https://images.icon-icons.com/270/PNG/512/Music_29918.png"
                    alt="Música"
                    >
                </div>
                <div id="imgbox7"
                  class="img_box">
                  <img id="img-starwars"
                    src="images/banner.png"
                    alt="Star Wars"
                    >
                </div>
              </div>
              <!-- Mensaje especial de la fuerza -->
              <div id="fuerza-msg">May the force be with you!</div>
            </div>
          </fieldset>

          <!-- Botones de acción -->
          <div class="d-grid gap-2 d-md-flex justify-content-md-center" style="margin-top: 30px;">
            <button class="btn btn-primary me-md-2" type="submit">Registrar Usuario</button>
            <a href="index.html" class="btn btn-secondary">Cancelar</a>
          </div>
        </fieldset>
      </form>
    </section>

    <!-- Página de Ayuda como subpágina -->
    <section id="ayuda" style="display:none; padding:40px 20px; max-width:600px; margin:40px auto; background:#23232b; border-radius:12px; box-shadow:0 4px 24px #0008; color:#fff;">
      <h2 style="color:#f18b32; margin-bottom:18px;">Ayuda</h2>
      <p>Esta es la <b>página de registro de usuarios</b> para administradores de la Galaxia Magna Academy.</p>
      <p>Aquí puedes registrar nuevos usuarios en el sistema proporcionando sus datos básicos.</p>
      <p>Si tienes dudas o necesitas ayuda, puedes contactar a <b>Allan VillaLobos</b>.</p>
      <button id="cerrar-ayuda" style="margin-top:24px; padding:10px 30px; border-radius:8px; background:#2563eb; color:#fff; border:none; font-weight:bold; cursor:pointer;">Cerrar</button>
    </section>
  </main>

  <footer>
  </footer>

  <!--
    Caja informativa:
    Este bloque invita a los usuarios a aprender más de HTML. El enlace lleva a W3Schools, un sitio recomendado para principiantes.
    TIP: Usa recursos externos para complementar tu aprendizaje.
  -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="script.js"></script>
  
  <script>
    // Contraseñas para roles especiales
    const ROL_PASSWORDS = {
      'profesor': 'profesor',
      'administrador': 'admin'
    };
    
    // Variable para controlar si el rol está validado
    let rolValidado = false;
    
    // Función para manejar cambios en el selector de rol
    function manejarCambioRol() {
      const rol = document.getElementById('rol').value;
      const passwordContainer = document.getElementById('password-rol-container');
      const passwordInput = document.getElementById('password-rol');
      const passwordHint = document.getElementById('password-rol-hint');
      
      // Resetear validación
      rolValidado = false;
      
      if (rol === 'profesor' || rol === 'administrador') {
        // Mostrar campo de contraseña para roles especiales
        passwordContainer.style.display = 'block';
        passwordInput.required = true;
        passwordInput.value = '';
        
        // Configurar hint según el rol
        if (rol === 'profesor') {
          passwordHint.textContent = 'Contraseña requerida para rol Profesor';
        } else if (rol === 'administrador') {
          passwordHint.textContent = 'Contraseña requerida para rol Administrador';
        }
        
        // Agregar validación en tiempo real
        passwordInput.addEventListener('input', validarPasswordRol);
        
      } else {
        // Ocultar campo de contraseña para estudiante
        passwordContainer.style.display = 'none';
        passwordInput.required = false;
        passwordInput.value = '';
        rolValidado = true; // Estudiante no necesita validación especial
      }
      
      // Generar código solo si el rol está validado
      if (rolValidado || rol === 'estudiante') {
        generarCodigoEstudiante();
      } else {
        document.getElementById('codigo-estudiante').value = '';
      }
    }
    
    // Función para validar la contraseña del rol
    function validarPasswordRol() {
      const rol = document.getElementById('rol').value;
      const passwordInput = document.getElementById('password-rol');
      const password = passwordInput.value;
      
      if (ROL_PASSWORDS[rol] && password === ROL_PASSWORDS[rol]) {
        // Contraseña correcta
        passwordInput.style.borderColor = '#28a745';
        passwordInput.style.backgroundColor = '#d4edda';
        rolValidado = true;
        generarCodigoEstudiante();
      } else if (password.length > 0) {
        // Contraseña incorrecta
        passwordInput.style.borderColor = '#dc3545';
        passwordInput.style.backgroundColor = '#f8d7da';
        rolValidado = false;
        document.getElementById('codigo-estudiante').value = '';
      } else {
        // Campo vacío
        passwordInput.style.borderColor = '';
        passwordInput.style.backgroundColor = '';
        rolValidado = false;
        document.getElementById('codigo-estudiante').value = '';
      }
    }
    
    // Función para generar código único de estudiante (modificada)
    function generarCodigoEstudiante() {
      const fechaInscripcion = document.getElementById('fecha-inscripcion').value;
      const rol = document.getElementById('rol').value;
      const codigoInput = document.getElementById('codigo-estudiante');
      
      // Verificar si el rol necesita validación y si está validado
      if ((rol === 'profesor' || rol === 'administrador') && !rolValidado) {
        codigoInput.value = '';
        return;
      }
      
      if (fechaInscripcion && rol) {
        const fecha = new Date(fechaInscripcion);
        const año = fecha.getFullYear();
        const mes = String(fecha.getMonth() + 1).padStart(2, '0');
        
        // Definir prefijo según el rol
        let prefijo;
        switch (rol) {
          case 'estudiante':
            prefijo = 'A';
            break;
          case 'profesor':
            prefijo = 'P';
            break;
          case 'administrador':
            prefijo = 'ADM';
            break;
          default:
            prefijo = 'A';
        }
        
        // Generar número secuencial (simulado)
        const numeroSecuencial = String(Math.floor(Math.random() * 9999) + 1).padStart(4, '0');
        
        // Formato: AAAA_MM_ROL_0001
        const codigo = `${año}_${mes}_${prefijo}_${numeroSecuencial}`;
        codigoInput.value = codigo;
      } else {
        codigoInput.value = '';
      }
    }
    
    // Función para reproducir sonido de lightsaber cuando se selecciona Star Wars
    function playLightsaberSound() {
      const audio = new Audio('misc/lightsaber-ignition-6816.mp3');
      audio.volume = 0.5; // Volumen al 50%
      audio.play().catch(function(error) {
        console.log('Error al reproducir el sonido:', error);
      });
    }

    // Función para validar formulario antes de enviar
    function validarFormulario(event) {
      const rol = document.getElementById('rol').value;
      
      // Verificar si es un rol especial y si está validado
      if ((rol === 'profesor' || rol === 'administrador') && !rolValidado) {
        event.preventDefault();
        alert('Debe ingresar la contraseña correcta para el rol ' + rol);
        return false;
      }
      
      // Verificar que el código de estudiante esté generado
      const codigo = document.getElementById('codigo-estudiante').value;
      if (!codigo) {
        event.preventDefault();
        alert('Error: No se ha generado el código. Verifique todos los campos.');
        return false;
      }
      
      return true;
    }
    
    // Auto-generar código cuando la página carga si ya hay datos
    document.addEventListener('DOMContentLoaded', function() {
      // Establecer fecha actual como fecha de inscripción por defecto
      const fechaInscripcion = document.getElementById('fecha-inscripcion');
      const hoy = new Date().toISOString().split('T')[0];
      fechaInscripcion.value = hoy;
      
      // Agregar validación al formulario
      const form = document.querySelector('form');
      if (form) {
        form.addEventListener('submit', validarFormulario);
      }
      
      // Configurar validación inicial del rol
      manejarCambioRol();
      
      // Generar código inicial si hay rol seleccionado
      generarCodigoEstudiante();
      
      // Agregar event listener para Star Wars checkbox
      const starWarsCheckbox = document.getElementById('interes7');
      if (starWarsCheckbox) {
        starWarsCheckbox.addEventListener('change', function() {
          if (this.checked) {
            playLightsaberSound();
            // Mostrar mensaje de la fuerza (si existe en el CSS)
            const fuerzaMsg = document.getElementById('fuerza-msg');
            if (fuerzaMsg) {
              fuerzaMsg.style.display = 'block';
              fuerzaMsg.style.opacity = '1';
              // Fade out después de 3 segundos
              setTimeout(function() {
                fuerzaMsg.style.transition = 'opacity 2s';
                fuerzaMsg.style.opacity = '0';
              }, 3000);
            }
          }
        });
      }
    });
  </script>
</body>
</html>
